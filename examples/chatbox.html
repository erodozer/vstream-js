<html>
    <head>
        <style>
            .icon {
                width: 1.5em;
                height: 1.5em;
                display: inline-block;
                position: relative;
            }

            .icon-streamer::after {
                content: "";
                background: url("");
                width: 100%;
                height: 100%;
                display: block;
            }
        </style>
        <script type="module">
            import vstream from '../vstream.js';

            const params = new URLSearchParams(window.location.search);
            const channelId = params.get('channelId');
            const videoId = params.get('videoId');
            vstream(channelId, videoId).then(
                ch => {
                    ch.addEventListener('chat-message', onChatMessage)
                }
            );

            const chatbox = document.querySelector('#chatbox');
            function onChatMessage(message) {
                const el = document.createElement('div');
                el.innerHTML = `
                    <div>
                        ${message.profile.badges.map(b => `<i class="icon icon-${b}"></i>)`).join('')}
                        <span style="color: ${message.profile.color}">${message.profile.displayName}</span>
                    </div>
                    <p>${message.text}</p>
                `;
                chatbox.appendChild(el);

                if (chatbox.childElementCount > 10) {
                    chatbox.firstChild.remove();
                }
            }
        </script>
    </head>
    <body>
        <div id="chatbox"></div>
    </body>
</html>
